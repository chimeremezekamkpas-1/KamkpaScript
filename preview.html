<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>KamkpaScript Preview</title>
<link href="style.css" rel="stylesheet"/>
</head>
<body>
  <button onclick="savePreview()">üíæ Save Preview</button>

<iframe id="outputFrame"></iframe>

<script>

function savePreview() {
  const frame = document.getElementById('outputFrame'); // your preview iframe
  const html = frame.srcdoc;

  // Create a Blob (HTML file)
  const blob = new Blob([html], { type: 'text/html' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);

  // Default name (you can adjust)
  link.download = 'KamkpaPreview.html';
  link.click();

  // Cleanup
  URL.revokeObjectURL(link.href);
  alert("‚úÖ Preview saved as HTML file successfully!");
}

// Retrieve code from editor
let code = localStorage.getItem("kamkpa_script_code") || "";
localStorage.removeItem("kamkpa_script_code");

// ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
//   FULL KamkpaScript Engine
// ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
function runKS(code) {
  const lines = code.trim().split('\n');
  const settings = {};

  // Parse .ks file lines into key-value pairs
  for (let line of lines) {
    if (!line.includes('=')) continue;
    let [key, value] = line.split('=');
    key = key.trim().replace(/^p\./, 'p_');
    key = key.replace(/-/g, '_');
    value = value.trim().replace(/['"]/g, '');
    settings[key] = value;
  }

  const projectType = settings.p_type;
  let html = "";

  // üß± WEB PAGE LOGIC
  if (projectType === 'web page') {
    html += `
    <html>
      <head>
        <title>${settings.title || ''}</title>
        <style>
          body {
            background: ${settings.background_color || 'white'};
            margin: 0;
            font-family: ${settings.font_family || 'Arial'};
            color: ${settings.text_color || 'black'};
            text-align: ${settings.text_align || 'center'};
          }
          h1 {
            color: ${settings.header_color || 'black'};
            text-align: ${settings.header_position || 'center'};
            padding: 20px;
            font-size: ${settings.text_size || '100px'};
          }
          footer {
            background: ${settings.footer_color || 'gray'};
            color: white;
            text-align: ${settings.footer_position || 'center'};
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
          }
          p {
            font-size: ${settings.text_size || '50px'};
            text-align: ${settings.text_align || 'center'};
          }
          button {
            background: ${settings.button_color || 'black'};
            color: white;
            border: none;
            padding: ${
              settings.button_size === 'large'
                ? '20px 40px'
                : settings.button_size === 'small'
                ? '5px 15px'
                : '10px 25px'
            };
            border-radius: ${
              settings.button_shape === 'circle'
                ? '50%'
                : settings.button_shape === 'rounded'
                ? '20px'
                : '0px'
            };
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
          }
          .btn-container {
            text-align: ${settings.button_position || 'center'};
            margin-top: 20px;
          }
          marquee {
            font-weight: bold;
            font-size: 20px;
            color: ${settings.text_color || 'blue'};
            margin: 10px 0;
          }
        </style>
      </head>
      <body>
        <h1>${settings.header_text || settings.title || ''}</h1>

        ${
          settings.marquee_text
            ? `<marquee>${settings.marquee_text}</marquee>`
            : ''
        }

        <p>${settings.paragraph || ''}</p>

        ${
          settings.image
            ? `<div style="text-align:center;">
                <img src="${settings.image}" alt="Image" 
                     style="max-width:90%;border-radius:10px;margin-top:10px;">
               </div>`
            : ''
        }

        ${
          settings.video
            ? `<div style="text-align:center;margin-top:15px;">
                <video controls style="max-width:90%;border-radius:10px;">
                  <source src="${settings.video}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
               </div>`
            : ''
        }

        ${
          settings.link
            ? `<p style="text-align:center;margin-top:15px;">
                <a href="${settings.link}" style="color:blue;text-decoration:underline;">Go to linked page</a>
               </p>`
            : ''
        }

        <div class="btn-container">
          ${
            settings.button_text
              ? `<button>${settings.button_text}</button>`
              : ''
          }
        </div>

        <footer>${settings.footer_text || ''}</footer>
      </body>
    </html>`;
  }

  // ü§ñ AI LOGIC
  else if (projectType === 'ai logic') {
    html += `
    <html>
      <body style="font-family:monospace; background:black; color:lime; padding:20px;">
        <h2>ü§ñ Kamkpas AI Logic Console</h2>
        <p>Input: ${settings.input || 'No input provided'}</p>
        <p>Output: ${settings.input ? settings.input.split('').reverse().join('') : 'AI logic placeholder'}</p>
      </body>
    </html>`;
  }

  // üí¨ CHATBOT
  else if (projectType === "chatbot") {
    html += `
    <html>
    <head>
      <style>
        body {
          background: ${settings.background_color || "black"};
          color: white;
          font-family: Arial;
          margin: 0;
          display: flex;
          flex-direction: column;
          height: 100vh;
        }
        header {
          background: #222;
          color: lime;
          padding: 10px;
          text-align: center;
          font-size: 20px;
        }
        #chatArea {
          flex: 1;
          overflow-y: auto;
          padding: 15px;
          display: flex;
          flex-direction: column;
          gap: 10px;
        }
        .user {
          align-self: flex-end;
          background: lime;
          color: black;
          padding: 8px 12px;
          border-radius: 15px 15px 0 15px;
        }
        .bot {
          align-self: flex-start;
          background: #333;
          color: white;
          padding: 8px 12px;
          border-radius: 15px 15px 15px 0;
        }
        #inputArea {
          display: flex;
          padding: 10px;
          background: #111;
        }
        #userMsg {
          flex: 1;
          background: #222;
          color: white;
          border: none;
          padding: 10px;
        }
        #sendBtn {
          background: lime;
          color: black;
          border: none;
          padding: 10px 15px;
          margin-left: 10px;
        }
      </style>
    </head>
    <body>
      <header>${settings.header_text || "AI Chatbot"}</header>
      <div id="chatArea"></div>
      <div id="inputArea">
        <input id="userMsg" placeholder="Type a message..." />
        <button id="sendBtn">Send</button>
      </div>

      <script>
        const chatArea = document.getElementById("chatArea");
        const input = document.getElementById("userMsg");
        const sendBtn = document.getElementById("sendBtn");

        let chatMemory = [];

        function appendMessage(sender, message) {
          const msgDiv = document.createElement("div");
          msgDiv.className = sender;
          msgDiv.textContent = message;
          chatArea.appendChild(msgDiv);
          chatArea.scrollTop = chatArea.scrollHeight;
          chatMemory.push({ sender, message });
          if (chatMemory.length > 10) chatMemory.shift();
        }

        function generateReply(userMsg) {
          const lowerMsg = userMsg.toLowerCase();

          if (chatMemory.some(m => m.message.toLowerCase() === lowerMsg)) {
            return "You already said that before.";
          }
          if (lowerMsg.includes("how are you")) return "I'm doing fine!";
          if (lowerMsg.includes("who are you")) return "I'm Kamkpa AI.";
          if (lowerMsg.includes("remember")) return "Of course, I remember!";

          return ["Interesting.", "Tell me more.", "Okay.", "Hmm..."][Math.floor(Math.random()*4)];
        }

        function sendMsg() {
          const msg = input.value.trim();
          if (!msg) return;
          appendMessage("user", msg);
          input.value = "";
          setTimeout(() => {
            appendMessage("bot", generateReply(msg));
          }, 400);
        }

        sendBtn.onclick = sendMsg;
        input.addEventListener("keypress", e => {
          if (e.key === "Enter") sendMsg();
        });
      <\/script>
    </body>
    </html>`;
  }

  // üéÆ GAME LOGIC
  else if (projectType === 'game logic') {
    html += `
    <html>
      <body style="background:#223; color:#0f0; text-align:center; font-family:monospace;">
        <h2>üéÆ Kamkpas Game Logic Test</h2>
        <p>Game Name: ${settings.title || 'Untitled Game'}</p>
        <p>Logic: ${settings.logic || 'No game logic defined'}</p>
        <p>Status: Running basic simulation...</p>
      </body>
    </html>`;
  }
  
// üéûÔ∏è ANIMATION LOGIC (Upgraded)
else if (projectType === 'animation') {

  const animateType = settings.animate || 'move';
  const loopMode = settings.loop === 'true' ? 'infinite' : '1';
  const duration = settings.duration || '3s';
  const color = settings.object_color || 'blue';
  const size = settings.object_size || '100px';
  const bg = settings.canvas_color || 'black';
  const shape = settings.object || 'box';

  // üî∑ Base shape style
  let objectShape = `
    width: ${size};
    height: ${size};
    background: ${color};
    position: relative;
  `;

  // üü¢ Shape Variants
  if (shape === 'circle') {
    objectShape += `border-radius: 50%;`;
  } 
  else if (shape === 'oval') {
    objectShape += `border-radius: 50%; width: calc(${size} * 1.5);`;
  } 
  else if (shape === 'triangle') {
    objectShape = `
      width: 0;
      height: 0;
      border-left: calc(${size} / 2) solid transparent;
      border-right: calc(${size} / 2) solid transparent;
      border-bottom: ${size} solid ${color};
      position: relative;
    `;
  } 
  else if (shape === 'diamond') {
    objectShape += `transform: rotate(45deg);`;
  } 
  else if (shape === 'line') {
    objectShape = `
      width: calc(${size} * 2);
      height: 5px;
      background: ${color};
      position: relative;
    `;
  }
  
  // üåÄ Animation keyframes
  let keyframes = '';

  // MOVE Animation
  if (animateType === 'move') {
    let transform = 'translateX(0)';
    if (settings.direction === 'right') transform = `translateX(${settings.distance || '300px'})`;
    if (settings.direction === 'left') transform = `translateX(-${settings.distance || '300px'})`;
    if (settings.direction === 'up') transform = `translateY(-${settings.distance || '300px'})`;
    if (settings.direction === 'down') transform = `translateY(${settings.distance || '300px'})`;

    keyframes = `
      @keyframes animMove {
        from { transform: translate(0, 0); }
        to { transform: ${transform}; }
      }
    `;
  }

  // ROTATE Animation
  else if (animateType === 'rotate') {
    const angle = settings.angle || '360deg';
    keyframes = `
      @keyframes animRotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(${angle}); }
      }
    `;
  }

  // BOUNCE Animation
  else if (animateType === 'bounce') {
    const height = settings.height || '150px';
    keyframes = `
      @keyframes animBounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-${height}); }
      }
    `;
  }

  // FADE Animation
  else if (animateType === 'fade') {
    const opacity = settings.opacity || '0.2';
    keyframes = `
      @keyframes animFade {
        0%, 100% { opacity: 1; }
        50% { opacity: ${opacity}; }
      }
    `;
  }

  // CIRCLE Animation
  else if (animateType === 'circle') {
    const radius = settings.radius || '200px';
    keyframes = `
      @keyframes animCircle {
        0% { transform: rotate(0deg) translate(${radius}) rotate(0deg); }
        100% { transform: rotate(360deg) translate(${radius}) rotate(-360deg); }
      }
    `;
  }

  // üß© Output HTML
  html += `
  <html>
    <head>
      <title>${settings.title || 'Animation'}</title>
      <style>
        body {
          margin: 0;
          background: ${bg};
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          overflow: hidden;
        }
        .object {
          ${objectShape}
          animation: anim${animateType.charAt(0).toUpperCase() + animateType.slice(1)} ${duration} linear ${loopMode};
        }
        ${keyframes}
      </style>
    </head>
    <body>
      <div class="object"></div>
    </body>
  </html>`;
}

// üéûÔ∏è ANIMATION LOGIC ‚Äî MULTI OBJECT UPGRADE
else if (projectType === 'animation logic') {

  const bg = settings.canvas_color || 'black';
  const loopMode = settings.loop === 'true' ? 'infinite' : '1';

  let objectsHTML = '';
  let objectsCSS = '';
  let keyframesCSS = '';

  // Detect objects: object1, object2, object3...
  Object.keys(settings).forEach(key => {
    const match = key.match(/^object(\d+)$/);
    if (!match) return;

    const i = match[1];

    const shape = settings[`object${i}`] || 'box';
    const color = settings[`object${i}_color`] || 'blue';
    const size = settings[`object${i}_size`] || '100px';
    const animate = settings[`object${i}_animate`] || 'move';
    const duration = settings[`object${i}_duration`] || '3s';
    const position = settings[`object${i}_position`] || 'center';

    let objectStyle = `
      position: absolute;
      background: ${color};
      width: ${size};
      height: ${size};
    `;

    // üî∑ Shape handling
    if (shape === 'circle') objectStyle += `border-radius: 50%;`;
    else if (shape === 'oval') objectStyle += `border-radius: 50%; width: calc(${size} * 1.5);`;
    else if (shape === 'triangle') {
      objectStyle = `
        width: 0;
        height: 0;
        border-left: calc(${size} / 2) solid transparent;
        border-right: calc(${size} / 2) solid transparent;
        border-bottom: ${size} solid ${color};
        position: absolute;
      `;
    }
    else if (shape === 'diamond') objectStyle += `transform: rotate(45deg);`;
    else if (shape === 'line') {
      objectStyle = `
        width: calc(${size} * 2);
        height: 5px;
        background: ${color};
        position: absolute;
      `;
    }
    
    // üìç Object position handling
let posStyle = '';

if (position === 'center') {
  posStyle = `
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  `;
}
else if (position === 'up') {
  posStyle = `
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
  `;
}
else if (position === 'down') {
  posStyle = `
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
  `;
}
else if (position === 'left') {
  posStyle = `
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
  `;
}
else if (position === 'right') {
  posStyle = `
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
  `;
}
    
    // üåÄ Animation logic
    let animName = `anim${animate}${i}`;

    if (animate === 'move') {
      const dir = settings[`object${i}_direction`] || 'right';
      const dist = settings[`object${i}_distance`] || '200px';

      let transform = 'translateX(0)';
      if (dir === 'right') transform = `translateX(${dist})`;
      if (dir === 'left') transform = `translateX(-${dist})`;
      if (dir === 'up') transform = `translateY(-${dist})`;
      if (dir === 'down') transform = `translateY(${dist})`;

      keyframesCSS += `
        @keyframes ${animName} {
          from { transform: translate(0,0); }
          to { transform: ${transform}; }
        }
      `;
    }

    else if (animate === 'rotate') {
      const angle = settings[`object${i}_angle`] || '360deg';
      keyframesCSS += `
        @keyframes ${animName} {
          from { transform: rotate(0deg); }
          to { transform: rotate(${angle}); }
        }
      `;
    }

    else if (animate === 'bounce') {
      const height = settings[`object${i}_height`] || '120px';
      keyframesCSS += `
        @keyframes ${animName} {
          0%,100% { transform: translateY(0); }
          50% { transform: translateY(-${height}); }
        }
      `;
    }

    else if (animate === 'fade') {
      const opacity = settings[`object${i}_opacity`] || '0.3';
      keyframesCSS += `
        @keyframes ${animName} {
          0%,100% { opacity: 1; }
          50% { opacity: ${opacity}; }
        }
      `;
    }

    else if (animate === 'circle') {
      const radius = settings[`object${i}_radius`] || '200px';
      keyframesCSS += `
        @keyframes ${animName} {
          0% { transform: rotate(0deg) translate(${radius}) rotate(0deg); }
          100% { transform: rotate(360deg) translate(${radius}) rotate(-360deg); }
        }
      `;
    }

    objectsCSS += `
  .object-${i} {
    ${objectStyle}
    ${posStyle}
    animation: ${animName} ${duration} linear ${loopMode};
  }
`;

    objectsHTML += `<div class="object-${i}"></div>`;
  });

  html += `
  <html>
    <head>
      <title>${settings.title || 'Animation Scene'}</title>
      <style>
        body {
          margin: 0;
          background: ${bg};
          width: 100vw;
          height: 100vh;
          overflow: hidden;
          position: relative;
        }
        ${objectsCSS}
        ${keyframesCSS}
      </style>
    </head>
    <body>
      ${objectsHTML}
    </body>
  </html>`;
}

  // WEB SCRAPER LOGIC
  else if (projectType === 'scraper') {
    html += `
    <html>
      <body style="background:#222; color:#0f0; font-family:monospace;">
        <h2>üåê KamkpaScript Web Scraper</h2>
        <p>Target URL: ${settings.url || 'No URL provided'}</p>
        <p>Scrape Target: ${settings.target || 'N/A'}</p>
        <p>Note: Actual scraping not supported in browser mode.</p>
      </body>
    </html>`;
  }
  
  // üßç HUMAN CARTOON ANIMATION
else if (projectType === 'cartoon' && settings.character === 'human') {

  const bg = settings.canvas_color || 'skyblue';
  const height = parseInt(settings.height || '220');
  const skin = settings.skin_color || '#f1c27d';
  const shirt = settings.shirt_color || 'red';
  const trouser = settings.trouser_color || 'blue';
  const shoe = settings.shoe_color || 'black';
  const loopMode = settings.loop === 'true' ? 'infinite' : '1';

  html += `
  <html>
  <head>
    <style>
      body {
        margin: 0;
        background: ${bg};
        overflow: hidden;
        height: 100vh;
      }

      .ground {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 80px;
        background: #333;
      }

      .human {
        position: absolute;
        bottom: 80px;
        left: -100px;
        animation: walk 1s ${loopMode}, move 5s linear ${loopMode};
      }

      .head {
        width: 60px;
        height: 60px;
        background: ${skin};
        border-radius: 50%;
        margin: auto;
      }

      .body {
        width: 70px;
        height: 80px;
        background: ${shirt};
        margin: auto;
      }

      .arm {
        width: 15px;
        height: 70px;
        background: ${skin};
        position: absolute;
        top: 70px;
        animation: swing 0.5s ${loopMode};
      }

      .arm.left { left: -15px; }
      .arm.right { right: -15px; }

      .leg {
        width: 18px;
        height: 80px;
        background: ${trouser};
        position: absolute;
        top: 150px;
        animation: walkLeg 0.5s ${loopMode};
      }

      .leg.left { left: 15px; }
      .leg.right { right: 15px; }

      .shoe {
        width: 25px;
        height: 12px;
        background: ${shoe};
        position: absolute;
        bottom: -12px;
      }

      @keyframes swing {
        0% { transform: rotate(20deg); }
        50% { transform: rotate(-20deg); }
        100% { transform: rotate(20deg); }
      }

      @keyframes walkLeg {
        0% { transform: rotate(-20deg); }
        50% { transform: rotate(20deg); }
        100% { transform: rotate(-20deg); }
      }

      @keyframes move {
        from { left: -100px; }
        to { left: 100%; }
      }
    </style>
  </head>
  <body>
    <div class="human">
      <div class="head"></div>
      <div class="body"></div>
      <div class="arm left"></div>
      <div class="arm right"></div>
      <div class="leg left"><div class="shoe"></div></div>
      <div class="leg right"><div class="shoe"></div></div>
    </div>
    ${settings.ground === 'true' ? `<div class="ground"></div>` : ''}
  </body>
  </html>`;
}

// üé≠ CARTOON 2.5D LOGIC
else if (projectType === 'cartoon logic') {

  const bg = settings.scene_color || 'black';
  const depth = settings.depth || '200px';
  const perspective = settings.perspective || '800px';
  const rotateY = settings.rotate_y || '0deg';
  const rotateX = settings.rotate_x || '0deg';
  const duration = settings.duration || '2s';
  const loop = settings.loop === 'true' ? 'infinite' : '1';

  html += `
  <html>
  <head>
    <style>
      body {
        margin: 0;
        background: ${bg};
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
      }

      .scene {
        perspective: ${perspective};
      }

      .character {
        width: 120px;
        height: 260px;
        position: relative;
        transform-style: preserve-3d;
        transform:
          rotateY(${rotateY})
          rotateX(${rotateX})
          translateZ(${depth});
        animation: walk ${duration} ease-in-out ${loop};
      }

      /* BODY PARTS */
      .head {
        width: 80px;
        height: 80px;
        background: #f1c27d;
        border-radius: 50%;
        margin: auto;
      }

      .body {
        width: 100px;
        height: 120px;
        background: #3498db;
        margin: 10px auto;
        border-radius: 20px;
      }

      .legs {
        width: 100px;
        height: 60px;
        background: #2c3e50;
        margin: auto;
        border-radius: 10px;
      }

      @keyframes walk {
        0% { transform: translateZ(${depth}) rotateY(${rotateY}); }
        50% { transform: translateZ(${depth}) rotateY(calc(${rotateY} * -1)); }
        100% { transform: translateZ(${depth}) rotateY(${rotateY}); }
      }
    </style>
  </head>

  <body>
    <div class="scene">
      <div class="character">
        <div class="head"></div>
        <div class="body"></div>
        <div class="legs"></div>
      </div>
    </div>
  </body>
  </html>`;
}



  // üï∑Ô∏è WEB CRAWLER
  else if (projectType === 'web crawler' || projectType === 'crawler') {
    html += `
    <html>
      <body style="background:black;color:lime;font-size:50px;font-family:monospace;padding:20px;">
        <h2>üï∑Ô∏è KamkpaScript Web Crawler</h2>
        <p><strong>Project Title:</strong> ${settings.title || 'Untitled Crawler'}</p>
        <p><strong>Target URL:</strong> ${settings.target_url || 'https://example.com'}</p>
        <p><strong>Max Depth:</strong> ${settings.max_depth || '3'}</p>
        <p><strong>Mode:</strong> ${settings.crawl_mode || 'links only'}</p>
        <hr>
        <div id="crawlResults"></div>

        <script>
          const crawlResults = document.getElementById("crawlResults");
          const startURL = "${settings.target_url || 'https://example.com'}";
          const links = [
            startURL + "/about",
            startURL + "/contact",
            startURL + "/products",
            startURL + "/blog",
            startURL + "/faq"
          ];

          let i = 0;
          function displayNextLink() {
            if (i < links.length) {
              const link = document.createElement('a');
              link.href = links[i];
              link.target = "_blank";
              link.textContent = links[i];
              link.style.color = 'aqua';

              const line = document.createElement('div');
              line.appendChild(link);
              crawlResults.appendChild(line);

              i++;
              setTimeout(displayNextLink, 800);
            } else {
              const done = document.createElement('p');
              done.textContent = "Crawling completed.";
              crawlResults.appendChild(done);
            }
          }
          displayNextLink();
        <\/script>
      </body>
    </html>`;
  }

  // SEARCH ENGINE
  else if (projectType === 'search engine') {
    html += `
  <html>
  <head>
    <style>
      body {
        background: ${settings.background_color || 'black'};
        color: ${settings.text_color || 'white'};
        font-family:
        monospace;
        font-size: 50px;
        margin: 0;
        padding: 20px;
      }
      h2 {
        text-align: center;
        color: ${settings.text_color || 'yellow'};
      }
      #searchBar {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }
      #query {
        flex: 1;
        padding: 10px;
        font-size: 50px;
        border: none;
        border-radius: 5px 0 0 5px;
      }
      #searchBtn {
        background: red;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: bold;
        border-radius: 0 5px 5px 0;
        font-size: 40px;
      }
      #results {
        margin-top: 20px;
        line-height: 1.6;
      }
      .result-item {
        background: #222;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      .result-item a {
        color: deepskyblue;
        text-decoration: none;
        font-weight: bold;
      }
      .result-item a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h2>${settings.title || "Kamkpa Search Engine"}</h2>
    <input id="query" placeholder="Search...">
    <button id="searchBtn">Search</button>
    <div id="results"></div>

    <script>
      const resultsDiv = document.getElementById("results");
      const queryInput = document.getElementById("query");
      const searchBtn = document.getElementById("searchBtn");

      async function searchWeb() {
        let q = queryInput.value.trim();
        if (!q) return alert("Enter search.");

        resultsDiv.innerHTML = "Searching...";

        const res = await fetch("https://api.duckduckgo.com/?q=" + encodeURIComponent(q) + "&format=json");
        const data = await res.json();

        let out = "";
        if (data.RelatedTopics) {
          data.RelatedTopics.forEach(t => {
            if (t.Text && t.FirstURL) {
              out += "<div class='result-item'><a href='"+t.FirstURL+"' target='_blank'>"+t.Text+"</a></div>";
            }
          });
        }
        resultsDiv.innerHTML = out || "No results";
      }

      searchBtn.onclick = searchWeb;
      queryInput.onkeypress = e => { if (e.key === "Enter") searchWeb(); }
    <\/script>
  </body>
  </html>`;
  }
  
  

  // UNKNOWN PROJECT TYPE
  else {
    html = `<html><body><h2 style="color:red;text-align:center;">Unknown Project Type: ${projectType}</h2></body></html>`;
  }

  return html;
}

// Render to iframe
document.getElementById("outputFrame").srcdoc = runKS(code);
</script>

</body>
</html>