<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>KamkpaScript Editor</title>
<link href="style.css" rel="stylesheet"/>
</head>
<body>
<h2 style="text-align:center;">ğŸ’» KamkpaScript Editor</h2>

<div class="controls">
  <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ Load</button>
  <button onclick="saveFile()">ğŸ’¾ Save</button>
  <button onclick="saveAsFile()">ğŸ’¾ Save As</button>
    <button onclick="document.getElementById('fileInput').click()">
  </div>

  <input type="file" id="fileInput" accept=".ks">

<textarea id="ksCode">p.type = 'web page'
title = 'Day in a life'
background-color = 'blue'
header-color = 'white'
header-text = 'Day in a life'
paragraph = 'Welcome to my first KamkpaScript webpage.'
footer-color = 'black'
footer-text = 'Â© 2025 KamkpaScript'</textarea>

<button onclick="openPreview()">â–¶ï¸ Run KamkpaScript</button>

<script>

/************************************
     * ğŸ“ Load .ks File from Storage
     ************************************/
    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('ksCode').value = e.target.result;
      };
      reader.readAsText(file);
    });
    
    /************************************
     * ğŸ’¾ Save (using last file name)
     ************************************/
    function saveFile() {
      const code = document.getElementById("ksCode").value;
      downloadFile(lastFileName, code);
    }

    /************************************
     * ğŸ’¾ Save As (ask for new name)
     ************************************/
    function saveAsFile() {
      const code = document.getElementById("ksCode").value;
      const newName = prompt("Enter file name (without extension):", "myProject");
      if (newName) {
        lastFileName = newName.endsWith(".ks") ? newName : newName + ".ks";
        downloadFile(lastFileName, code);
      }
    }
    
    /************************************
     * ğŸ§© Download Helper (browser-safe)
     ************************************/
    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
      alert("âœ… File saved successfully as " + filename);
    }

// Send textarea code to preview.html
function openPreview() {
    const code = document.getElementById('ksCode').value;
    localStorage.setItem("kamkpa_script_code", code);
    window.location.href = "preview.html";
}


</script>

</body>
</html>